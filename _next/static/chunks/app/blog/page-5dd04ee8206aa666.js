(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{2068:(e,t,n)=>{Promise.resolve().then(n.bind(n,4269))},4269:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(5155),r=n(2115),o=n(6766),a=n(7431),l=n(3264);function s(){let[e,t]=(0,r.useState)(null),[n,s]=(0,r.useState)(!1),[d,c]=(0,r.useState)(null),[u,p]=(0,r.useState)(!1),[f,h]=(0,r.useState)(!1),[m,x]=(0,r.useState)(1200),g=(0,r.useRef)(null),w=(0,r.useRef)(null),v=(0,r.useRef)(null),b=(0,r.useRef)(null),y=(0,r.useRef)(null),C=(0,r.useRef)(void 0);function j(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("[AR DEBUG]",...t);let i=w.current;if(!i)return;let r=document.createElement("div");for(r.textContent=t.map(e=>"object"==typeof e&&null!==e?JSON.stringify(e,null,2):String(e)).join(" "),i.appendChild(r);i.childElementCount>200;)i.removeChild(i.firstChild);i.scrollTop=i.scrollHeight}let k=(0,r.useCallback)(()=>{var e;b.current&&(j("ending XRSession"),b.current.end(),b.current=null),null!=y.current&&(cancelAnimationFrame(y.current),y.current=null),(null==(e=v.current)?void 0:e.parentElement)&&(v.current.parentElement.removeChild(v.current),v.current=null),C.current&&(C.current.cancel(),C.current=null),h(!1)},[]);function R(){t(null),k()}async function S(e,t){if(!u)return void j("← AR not supported");w.current&&(w.current.innerHTML=""),j("→ launchAR()",{image:e,size:t});try{j("1) requesting camera"),(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),j("→ camera granted"),j("2) requesting XRSession with plane-detection");let n=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["plane-detection","dom-overlay"],domOverlay:{root:g.current}});b.current=n,h(!0),j("→ XRSession started");let i=document.createElement("div");Object.assign(i.style,{position:"absolute",top:"5px",left:"5px",background:"rgba(0,0,0,0.7)",color:"white",padding:"4px",fontSize:"10px",zIndex:"9999",pointerEvents:"none"}),i.innerText="AR initializing…",document.body.appendChild(i);let r=document.createElement("canvas");Object.assign(r.style,{position:"fixed",top:0,left:0,width:"100%",height:"100%"}),document.body.appendChild(r),v.current=r,j("3) canvas added");let o=r.getContext("webgl2",{xrCompatible:!0,alpha:!0});await o.makeXRCompatible(),j("→ gl.makeXRCompatible()");let s=new XRWebGLLayer(n,o);await n.updateRenderState({baseLayer:s}),j("4) XRWebGLLayer bound");let d=new a.JeP({canvas:r,context:o,alpha:!0});d.setPixelRatio(window.devicePixelRatio),d.setSize(window.innerWidth,window.innerHeight),d.xr.enabled=!0,d.xr.setReferenceSpaceType("local"),d.xr.setSession(n),d.autoClear=!1,j("5) Three.js ready");let c=new l.Z58;c.add(new l.dth(0xffffff,4473924,1));let u=new l.ZyN(0xffffff,1.2);u.position.set(0,5,0),c.add(u);let p=new l.ubm(75,window.innerWidth/window.innerHeight,.1,1e3);p.position.set(0,1.6,3);let f=await n.requestReferenceSpace("local"),m=await n.requestReferenceSpace("viewer");j("6) reference spaces OK");let x=await n.requestHitTestSource({space:m});C.current=x,j("8) hit-test source OK");let w=!1;try{"trackedPlanes"in n?(w=!0,j("Plane detection supported!")):j("Plane detection not supported, falling back")}catch(e){j("Plane detection check failed",e),w=!1}let R=new l.YJl;c.add(R);let S=new l.eaF(new l.rKP(.1,.11,32),new l.V9B({color:0xffffff,side:l.$EB}));S.matrixAutoUpdate=!1,S.visible=!1,c.add(S);let E=null,z=!1,P=!1,F="unknown",A=new l.Pq0,T=new l.PTz,q=new l.Tap;q.setCrossOrigin("anonymous"),q.load(e.src,n=>{j("✅ texture loaded",e.src);let i=.01*t.widthCm,r=.01*t.heightCm;n.colorSpace=l.er$,n.flipY=!1,n.needsUpdate=!0;let o=n.image,a=o.naturalWidth,s=o.naturalHeight,d=a/s,c=i/r,u=i,p=r;d>c?p=i/d:u=r*d;let f=new l.V9B({color:0xffffff,side:l.$EB}),h=new l.bdM(i,r),m=new l.eaF(h,f);R.add(m);let x=new l.V9B({map:n,side:l.$EB,transparent:!1,depthTest:!0,depthWrite:!0}),g=new l.bdM(u,p),w=new l.eaF(g,x);w.position.z=.001,R.add(w),j("Planes added",{physical:{w:i,h:r},image:{imgW:a,imgH:s,imgAspect:d},mesh:{meshW:u,meshH:p}})},e=>{if(e.total){let t=(e.loaded/e.total*100).toFixed(0);j("Loading texture ".concat(t,"%"))}},e=>{j("❌ texture error",e);let n=.01*t.widthCm,i=.01*t.heightCm,r=new l.V9B({color:65280,side:l.$EB}),o=new l.bdM(n,i),a=new l.eaF(o,r);a.position.z=.01,R.add(a),j("Fallback plane added")}),n.requestAnimationFrame(function e(t,i){y.current=n.requestAnimationFrame(e);let r=n.renderState.baseLayer;o.bindFramebuffer(o.FRAMEBUFFER,r.framebuffer),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);let a=i.getViewerPose(f);if(!a){S.visible=!1;return}let s=a.views[0],u=r.getViewport(s);if(!u)return;d.setViewport(u.x,u.y,u.width,u.height),p.matrix.fromArray(s.transform.matrix),p.projectionMatrix.fromArray(s.projectionMatrix),p.updateMatrixWorld(!0);let h=i.getHitTestResults(x);if(h.length>0){let e=null,t=-1/0;for(let n of(F="unknown",h)){let i=n.getPose(f);if(!i)continue;let r=0,o="unknown",a="hitPlane"in n?n.hitPlane:void 0;if(a&&w)o=a.orientation||"unknown",r=1;else{let e=new l.kn4().fromArray(i.transform.matrix),t=new l.Pq0(0,0,1).applyMatrix4(e).normalize(),n=new l.Pq0(0,1,0),a=t.dot(n);r=Math.abs(a),Math.abs(a)>.8?o="horizontal":.2>Math.abs(a)&&(o="vertical")}r>t&&(t=r,e=n,F="horizontal"===o?"floor":"vertical"===o?"wall":"unknown")}if(e){E=e.getPose(f).transform;let t=new l.Pq0().copy(E.position),n=new l.PTz().copy(E.orientation);A.lerp(t,.30000000000000004),T.slerp(n,.30000000000000004),S.visible=!0,S.position.copy(A),S.quaternion.copy(T),S.material.color.set(P?255:"wall"===F?65280:"floor"===F?0xffff00:0xff0000),z?P&&(R.position.copy(A),j("Dragging to new position",A)):(R.position.copy(A),R.quaternion.copy(T),"floor"===F&&(R.rotation.x=-Math.PI/2))}else E=null,S.visible=!1}else E=null,S.visible=!1;d.render(c,p)}),n.addEventListener("selectstart",()=>{if(!E)return void j("selectstart but no hit; ignoring");z?(P=!0,j("Starting drag mode")):(R.position.copy(A),R.quaternion.copy(T),"floor"===F&&(R.rotation.x=-Math.PI/2),z=!0,j("Placed painting at",A,"on",F))}),n.addEventListener("selectend",()=>{P&&(P=!1,j("Ended drag mode at",A))}),n.addEventListener("end",()=>{j("XRSession ended"),k()})}catch(e){j("❌ launchAR error",e),k()}}return(0,r.useEffect)(()=>()=>{k()},[k]),(0,r.useEffect)(()=>{function e(){x(window.innerWidth)}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{var e;(null==(e=navigator.xr)?void 0:e.isSessionSupported)&&navigator.xr.isSessionSupported("immersive-ar").then(e=>{p(e),j("AR supported?",e)}).catch(e=>j("AR support check failed",e))},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{maxWidth:1400,margin:"0 auto",padding:"2rem"},children:[(0,i.jsx)("h1",{style:{textAlign:"center",fontWeight:300},children:"Print Collection"}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(300px,1fr))",gap:"2rem"},children:[{id:1,title:"Mountain Sunset",src:"/my-lovely-app/images/source.jpg",description:"35mm film scan of mountain landscape at sunset. Captured on Kodak Portra 400 with a Nikon F3.",sizes:[{size:'8x10"',price:45,widthCm:25.4,heightCm:20.32},{size:'11x14"',price:75,widthCm:35.56,heightCm:27.94},{size:'16x20"',price:120,widthCm:50.8,heightCm:40.64}],tags:["landscape","35mm","color"]}].map(e=>(0,i.jsxs)("div",{onClick:()=>{t(e),s(!1),c(null)},style:{cursor:"pointer",overflow:"hidden",borderRadius:8,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",background:"white"},children:[(0,i.jsx)("div",{style:{position:"relative",height:240},children:(0,i.jsx)(o.default,{src:e.src,alt:e.title,fill:!0,style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{style:{padding:"1rem",borderTop:"1px solid #eee"},children:[(0,i.jsx)("h3",{style:{margin:0},children:e.title}),(0,i.jsx)("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:e.tags.map(e=>(0,i.jsx)("span",{style:{background:"#f0f0f0",padding:"0.2rem 0.5rem",borderRadius:12,fontSize:12,color:"#666"},children:e},e))})]})]},e.id))}),e&&(0,i.jsx)("div",{onClick:R,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,i.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{background:"white",borderRadius:8,display:m>768?"flex":"block",width:"90%",maxWidth:1200,maxHeight:"90vh",overflow:"hidden"},children:[(0,i.jsx)("button",{onClick:R,style:{position:"absolute",top:10,right:20,fontSize:24,background:"transparent",border:"none",cursor:"pointer",zIndex:1},children:"\xd7"}),(0,i.jsx)("div",{style:{flex:3,position:"relative",background:"#f5f5f5",height:m>768?"80vh":240},children:(0,i.jsx)(o.default,{src:e.src,alt:e.title,fill:!0,style:{objectFit:"contain"}})}),(0,i.jsxs)("div",{style:{flex:1,padding:"2rem",overflowY:"auto",borderLeft:m>768?"1px solid #eee":"none"},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:e.title}),(0,i.jsx)("button",{onClick:function(){s(e=>!e)},style:{marginBottom:"1rem"},children:n?"Hide Details":"Show Details"}),n&&(0,i.jsx)("p",{children:e.description}),(0,i.jsx)("h3",{children:"Available Sizes"}),(0,i.jsx)("ul",{style:{listStyle:"none",padding:0},children:e.sizes.map(t=>(0,i.jsxs)("li",{style:{marginBottom:"1rem"},children:[(0,i.jsxs)("label",{style:{cursor:"pointer"},children:[(0,i.jsx)("input",{type:"radio",name:"size",checked:d===t,onChange:()=>{c(t)}})," ",t.size," — $",t.price]}),u&&(0,i.jsx)("button",{onClick:()=>S(e,t),disabled:f,style:{marginLeft:8},children:f?"AR Active":"View in Your Space"})]},t.size))})]})]})}),(0,i.jsx)("div",{ref:g,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1100,pointerEvents:"none"}}),(0,i.jsx)("div",{ref:w,style:{position:"fixed",bottom:0,left:0,width:"100%",maxHeight:"200px",overflowY:"auto",background:"rgba(0,0,0,0.6)",color:"#0f0",fontSize:"11px",fontFamily:"monospace",padding:"4px 8px",zIndex:1200,pointerEvents:"none"}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[367,212,766,441,684,358],()=>t(2068)),_N_E=e.O()}]);