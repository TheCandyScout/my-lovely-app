(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{2068:(e,t,n)=>{Promise.resolve().then(n.bind(n,4269))},4269:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var i=n(5155),r=n(2115),o=n(6766),a=n(7431),l=n(3264);function s(){let[e,t]=(0,r.useState)(null),[n,s]=(0,r.useState)(!1),[d,p]=(0,r.useState)(null),[c,f]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[h,x]=(0,r.useState)(1200),g=(0,r.useRef)(null),v=(0,r.useRef)(null),y=(0,r.useRef)(null),w=(0,r.useRef)(null),b=(0,r.useRef)(null);function C(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("[AR DEBUG]",...t);let i=v.current;if(!i)return;let r=document.createElement("div");for(r.textContent=t.map(e=>e&&"object"==typeof e?JSON.stringify(e):String(e)).join(" "),i.appendChild(r);i.childElementCount>200;)i.removeChild(i.firstChild);i.scrollTop=i.scrollHeight}let j=(0,r.useCallback)(()=>{var e;w.current&&(w.current.end(),w.current=null),null!==b.current&&(cancelAnimationFrame(b.current),b.current=null),(null==(e=y.current)?void 0:e.parentElement)&&(y.current.parentElement.removeChild(y.current),y.current=null),u(!1)},[]);async function E(e,t){if(c){v.current.innerHTML="",C("launchAR()",e,t);try{var n;(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop());let i=await navigator.xr.requestSession("immersive-ar",{optionalFeatures:["dom-overlay","hit-test","plane-detection"],domOverlay:{root:g.current}});w.current=i,u(!0),i.addEventListener("end",()=>j());let r=document.createElement("canvas");Object.assign(r.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%"}),document.body.appendChild(r),y.current=r;let o=r.getContext("webgl2",{xrCompatible:!0,alpha:!0});await o.makeXRCompatible();let s=new XRWebGLLayer(i,o);i.updateRenderState({baseLayer:s});let d=new a.JeP({canvas:r,context:o,alpha:!0});d.setSize(window.innerWidth,window.innerHeight),d.xr.enabled=!0,d.xr.setReferenceSpaceType("local"),d.xr.setSession(i);let p=new l.Z58;p.add(new l.dth(0xffffff,4473924,1));let c=new l.ZyN(0xffffff,1.2);c.position.set(0,5,0),p.add(c);let f=new l.ubm(75,window.innerWidth/window.innerHeight,.1,1e3),m=await i.requestReferenceSpace("local"),h=new l.YJl;h.visible=!1,p.add(h);let x=new Map,v=new l.V9B({color:65280,side:l.$EB,transparent:!0,opacity:.5,wireframe:!0}),E=new l.V9B({color:0xff0000,side:l.$EB,transparent:!0,opacity:.5,wireframe:!0}),S=new l.Tap;S.setCrossOrigin("anonymous"),S.load(e.src,e=>{let n=.01*t.widthCm,i=.01*t.heightCm;e.flipY=!1,e.colorSpace=l.er$;let r=e.image,o=r.naturalWidth/r.naturalHeight,a=n/i,s=n,d=i;o>a?d=n/o:s=i*o;let p=new l.eaF(new l.bdM(n,i),new l.V9B({color:0xffffff,side:l.$EB}));h.add(p);let c=new l.eaF(new l.bdM(s,d),new l.V9B({map:e,side:l.$EB}));c.position.z=.001,h.add(c)},void 0,e=>C("texture error",e));let z=!1,k=null;i.addEventListener("planeadded",e=>{for(let t of(C("".concat(e.planes.length," planes added")),e.planes)){let e=new l.bdM(1,1),n=t.polygon.length>=4?v:E,i=new l.eaF(e,n);p.add(i),x.set(t.planeId,{mesh:i,plane:t}),C("Plane ".concat(t.planeId," added with ").concat(t.polygon.length," points"))}}),i.addEventListener("planeupdated",e=>{for(let t of e.planes){let e=x.get(t.planeId);if(e){let n=t.polygon.length>=4;e.mesh.material=n?v:E}}}),i.addEventListener("planeremoved",e=>{for(let t of e.planes){let e=x.get(t.planeId);e&&(p.remove(e.mesh),x.delete(t.planeId))}});let R=(e,t)=>{b.current=i.requestAnimationFrame(R),k=t;let n=i.renderState.baseLayer;o.bindFramebuffer(o.FRAMEBUFFER,n.framebuffer),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);let r=t.getViewerPose(m);if(!r)return;let a=r.views[0],l=n.getViewport(a);if(l){for(let[e]of(d.setViewport(l.x,l.y,l.width,l.height),f.matrix.fromArray(a.transform.matrix),f.projectionMatrix.fromArray(a.projectionMatrix),f.updateMatrixWorld(!0),x.entries())){let n=e.plane,i=e.mesh,r=t.getPose(n.planeSpace,m);if(r&&(i.position.set(r.transform.position.x,r.transform.position.y,r.transform.position.z),i.quaternion.set(r.transform.orientation.x,r.transform.orientation.y,r.transform.orientation.z,r.transform.orientation.w),n.polygon.length>=4)){let e=1/0,t=-1/0,r=1/0,o=-1/0;for(let i of n.polygon)e=Math.min(e,i.x),t=Math.max(t,i.x),r=Math.min(r,i.z),o=Math.max(o,i.z);let a=t-e,l=o-r;i.scale.set(a,1,l)}}d.render(p,f)}};i.requestAnimationFrame(R),i.addEventListener("select",()=>{if(z||!k)return;let e=k,t=e.getViewerPose(m);if(!t)return;let n=null;for(let[i]of x.entries()){let r=i.plane,o=i.mesh;if(o.material===v){let i=e.getPose(r.planeSpace,m);if(i){let e=new l.Pq0(i.transform.position.x-t.transform.position.x,i.transform.position.y-t.transform.position.y,i.transform.position.z-t.transform.position.z).length();(!n||e<n.distance)&&(n={plane:r,mesh:o,pose:i,distance:e})}}}if(n){for(let e of(h.position.set(n.pose.transform.position.x,n.pose.transform.position.y,n.pose.transform.position.z),h.quaternion.set(n.pose.transform.orientation.x,n.pose.transform.orientation.y,n.pose.transform.orientation.z,n.pose.transform.orientation.w),h.visible=!0,z=!0,x.values()))e.mesh.visible=!1;C("\uD83D\uDCCC Placed image on selected plane")}else C("⚠️ No valid placement plane selected")});let F=document.createElement("button");F.textContent="Reset Placement",F.style.position="absolute",F.style.bottom="20px",F.style.left="50%",F.style.transform="translateX(-50%)",F.style.padding="10px 20px",F.style.backgroundColor="white",F.style.borderRadius="8px",F.style.pointerEvents="auto",F.addEventListener("click",()=>{for(let e of(h.visible=!1,z=!1,x.values()))e.mesh.visible=!0;C("\uD83D\uDD04 Reset placement - select a plane to place image")}),null==(n=g.current)||n.appendChild(F),i.addEventListener("end",()=>{F.parentNode&&F.parentNode.removeChild(F)})}catch(e){C("launchAR error",e),j()}}}function S(){t(null),j()}return(0,r.useEffect)(()=>()=>{j()},[j]),(0,r.useEffect)(()=>{let e=()=>x(window.innerWidth);return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{var e;(null==(e=navigator.xr)?void 0:e.isSessionSupported)&&navigator.xr.isSessionSupported("immersive-ar").then(e=>f(e)).catch(()=>f(!1))},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{style:{maxWidth:1400,margin:"0 auto",padding:"2rem"},children:[(0,i.jsx)("h1",{style:{textAlign:"center",fontWeight:300},children:"Print Collection"}),(0,i.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(300px,1fr))",gap:"2rem"},children:[{id:1,title:"Mountain Sunset",src:"/my-lovely-app/images/source.jpg",description:"35mm film scan of mountain landscape at sunset. Captured on Kodak Portra 400 with a Nikon F3.",sizes:[{size:'8x10"',price:45,widthCm:25.4,heightCm:20.32},{size:'11x14"',price:75,widthCm:35.56,heightCm:27.94},{size:'16x20"',price:120,widthCm:50.8,heightCm:40.64}],tags:["landscape","35mm","color"]}].map(e=>(0,i.jsxs)("div",{onClick:()=>{t(e),s(!1),p(null)},style:{cursor:"pointer",overflow:"hidden",borderRadius:8,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",background:"white"},children:[(0,i.jsx)("div",{style:{position:"relative",height:240},children:(0,i.jsx)(o.default,{src:e.src,alt:e.title,fill:!0,style:{objectFit:"cover"}})}),(0,i.jsxs)("div",{style:{padding:"1rem",borderTop:"1px solid #eee"},children:[(0,i.jsx)("h3",{style:{margin:0},children:e.title}),(0,i.jsx)("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:e.tags.map(e=>(0,i.jsx)("span",{style:{background:"#f0f0f0",padding:"0.2rem 0.5rem",borderRadius:12,fontSize:12,color:"#666"},children:e},e))})]})]},e.id))}),e&&(0,i.jsx)("div",{onClick:S,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.85)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,i.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{background:"white",borderRadius:8,display:h>768?"flex":"block",width:"90%",maxWidth:1200,maxHeight:"90vh",overflow:"hidden"},children:[(0,i.jsx)("button",{onClick:S,style:{position:"absolute",top:10,right:20,fontSize:24,background:"transparent",border:"none",cursor:"pointer",zIndex:1},children:"\xd7"}),(0,i.jsx)("div",{style:{flex:3,position:"relative",background:"#f5f5f5",height:h>768?"80vh":240},children:(0,i.jsx)(o.default,{src:e.src,alt:e.title,fill:!0,style:{objectFit:"contain"}})}),(0,i.jsxs)("div",{style:{flex:1,padding:"2rem",overflowY:"auto",borderLeft:h>768?"1px solid #eee":"none"},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:e.title}),(0,i.jsx)("button",{onClick:function(){s(e=>!e)},style:{marginBottom:"1rem"},children:n?"Hide Details":"Show Details"}),n&&(0,i.jsx)("p",{children:e.description}),(0,i.jsx)("h3",{children:"Available Sizes"}),(0,i.jsx)("ul",{style:{listStyle:"none",padding:0},children:e.sizes.map(t=>(0,i.jsxs)("li",{style:{marginBottom:"1rem"},children:[(0,i.jsxs)("label",{style:{cursor:"pointer"},children:[(0,i.jsx)("input",{type:"radio",name:"size",checked:d===t,onChange:()=>{p(t)}})," ",t.size," — $",t.price]}),c&&(0,i.jsx)("button",{onClick:()=>E(e,t),disabled:m,style:{marginLeft:8},children:m?"AR Active":"View in Your Space"})]},t.size))})]})]})}),(0,i.jsx)("div",{ref:g,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1100,pointerEvents:"none"}}),(0,i.jsx)("div",{ref:v,style:{position:"fixed",bottom:0,left:0,width:"100%",maxHeight:"200px",overflowY:"auto",background:"rgba(0,0,0,0.6)",color:"#0f0",fontSize:"11px",fontFamily:"monospace",padding:"4px 8px",zIndex:1200,pointerEvents:"none"}})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[367,212,766,441,684,358],()=>t(2068)),_N_E=e.O()}]);